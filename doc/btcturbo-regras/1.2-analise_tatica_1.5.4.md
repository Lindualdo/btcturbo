# BTC TURBO v1.5.4 - DOCUMENTAÇÃO EXECUÇÃO TÁTICA FINAL

**Versão:** 1.5.4 ✅ **IMPLEMENTADO**  
**Objetivo:** Setups inteligentes com dados reais TradingView  
**Data:** Junho 2025  

---

## 🎯 ARQUITETURA IMPLEMENTADA

```
dash_main_service > analise_tecnica_service > setup_detector_utils > setups
                                                    ↓
                                            analise_tecnica_helper
                                                    ↓
                                            tradingview_helper
```

---

## 📁 ESTRUTURA DE ARQUIVOS

```
dash_main/analise_tecnica/
├── analise_tecnica_service.py          # Orquestrador principal
├── setup_detector_utils.py             # Fornece dados técnicos + testa setups
├── gate_system_utils.py                # Mockado: sempre aprova
└── setups_compra/
    ├── oversold_extremo.py             # ✅ RSI 4H real
    ├── pullback_tendencia.py           # ✅ RSI + EMA144 real  
    ├── cruzamento_medias.py            # ✅ EMAs 17/34 4H real
    ├── teste_suporte.py                # ✅ EMA144 4H real
    └── rompimento_resistencia.py       # ✅ Sempre false

dash_main/helpers/
└── analise_tecnica_helper.py           # Busca dados técnicos via TradingView
```

---

## 🔧 RESPONSABILIDADES FINAIS

### **analise_tecnica_service.py**
- Gate system mockado (sempre aprova)
- Chama setup_detector_utils.identificar_setup()
- Retorna dados técnicos + estratégia

### **setup_detector_utils.py**
- Chama analise_tecnica_helper.get_todos_dados_tecnicos()
- Fornece dados consolidados para todos os setups
- Testa setups por prioridade (para no primeiro encontrado)

### **analise_tecnica_helper.py**
- Busca RSI 4H, EMAs 17/34/144 via TradingView
- Calcula distâncias percentuais
- Retorna dataset completo

### **gate_system_utils.py**
**Mockado:** Sempre retorna `{"liberado": True, "motivo": "Aprovado (mockado v1.5.4)"}`  
**Implementar depois:** Validações reais de score, health factor, margem

### **Setups Individuais**
Cada setup processa dados técnicos, calcula força própria e retorna estratégia completa.

---

## 📊 DADOS TÉCNICOS CONSOLIDADOS

```json
{
    "rsi_4h": 59.8,
    "precos": {
        "atual": 103500.0,
        "ema_17": 103200.0,
        "ema_144": 103000.0
    },
    "distancias": {
        "ema_144_distance": 0.48,
        "ema_17_distance": 0.29
    },
    "emas_cruzamento": {
        "ema_17_atual": 103200.0,
        "ema_34_atual": 103100.0,
        "ema_17_anterior": 103150.0,
        "ema_34_anterior": 103180.0
    },
    "timestamp": "2025-06-24T11:41:15.273893",
    "source": "tradingview_rsi4h_emas_ema144_real"
}
```

---

## 🎯 SETUPS IMPLEMENTADOS

### **1. OVERSOLD_EXTREMO** ✅ Real
- **Condição:** RSI 4H < 30
- **Fonte:** TradingView RSI 4H
- **Força:** Baseada na intensidade (15/20/25/30)
- **Tamanho:** 40% (mockado)
- **Urgência:** Crítica

### **2. PULLBACK_TENDENCIA** ✅ Real  
- **Condição:** RSI 4H < 45 + EMA144 distância ±3%
- **Fonte:** TradingView RSI 4H + EMA144 4H
- **Força:** Proximidade das condições ideais
- **Tamanho:** 30% (mockado)
- **Urgência:** Alta/Média por força

### **3. CRUZAMENTO_MEDIAS** ✅ Real
- **Condição:** EMA17 cruza EMA34 para cima (4H)
- **Fonte:** TradingView EMAs 17/34 4H
- **Força:** Diferença percentual após cruzamento
- **Tamanho:** 25% (mockado)
- **Urgência:** Alta/Média por força

### **4. TESTE_SUPORTE** ✅ Real
- **Condição:** Preço ±2% da EMA144
- **Fonte:** TradingView EMA144 4H + preço
- **Força:** Proximidade da EMA144
- **Tamanho:** 25% (mockado)
- **Urgência:** Média

### **5. ROMPIMENTO** ✅ Mockado
- **Condição:** Sempre false
- **Fonte:** N/A
- **Retorna:** Setup não encontrado

---

## 🔄 REGRAS DE FORÇA IMPLEMENTADAS

### **OVERSOLD_EXTREMO**
```python
if rsi < 15: return "muito_alta"
elif rsi < 20: return "alta"  
elif rsi < 25: return "media"
elif rsi < 30: return "baixa"
```

### **PULLBACK_TENDENCIA**
```python
if rsi < 35 and abs(ema_distance) < 1: return "muito_alta"
elif rsi < 40 and abs(ema_distance) < 2: return "alta"
elif rsi < 45 and abs(ema_distance) < 3: return "media"
else: return "baixa"
```

### **CRUZAMENTO_MEDIAS**
```python
diferenca_percent = ((ema_17 - ema_34) / ema_34) * 100
if diferenca_percent > 1.0: return "muito_alta"
elif diferenca_percent > 0.5: return "alta"
elif diferenca_percent > 0.1: return "media"
else: return "baixa"
```

### **TESTE_SUPORTE**
```python
abs_distance = abs(ema_distance)
if abs_distance < 0.5: return "muito_alta"
elif abs_distance < 1.0: return "alta"
elif abs_distance < 1.5: return "media"
elif abs_distance < 2.0: return "baixa"
```

---

## 🔄 SAÍDAS JSON

### **Setup Encontrado**
```json
{
    "tecnicos": {
        "rsi_4h": 42.3,
        "precos": {
            "atual": 103500.0,
            "ema_17": 103200.0,
            "ema_144": 103000.0
        },
        "distancias": {
            "ema_144_distance": 1.2,
            "ema_17_distance": 0.29
        },
        "emas_cruzamento": {...},
        "timestamp": "2025-06-24T11:41:15.273893",
        "source": "tradingview_rsi4h_emas_ema144_real"
    },
    "estrategia": {
        "decisao": "COMPRAR",
        "setup": "PULLBACK_TENDENCIA",
        "urgencia": "alta",
        "justificativa": "Pullback tendência: RSI 42.3 + EMA144 dist +1.2% (TradingView real)"
    }
}
```

### **Nenhum Setup**
```json
{
    "tecnicos": {
        "rsi_4h": 55.0,
        "precos": {...},
        "distancias": {...},
        "emas_cruzamento": {...},
        "timestamp": "2025-06-24T11:41:15.273893",
        "source": "tradingview_rsi4h_emas_ema144_real"
    },
    "estrategia": {
        "decisao": "AGUARDAR",
        "setup": "NENHUM",
        "urgencia": "baixa", 
        "justificativa": "Nenhum setup identificado - aguardando condições favoráveis"
    }
}
```

### **Gate Bloqueado** (mockado)
```json
{
    "tecnicos": {},
    "estrategia": {
        "decisao": "BLOQUEADO",
        "setup": "NAO_IDENTIFICADO",
        "urgencia": "alta",
        "justificativa": "Gate bloqueado: [motivo]"
    }
}
```

---

## 🚫 REMOVIDOS v1.5.4

- ❌ `comprar_helper.py` (lógica integrada nos setups)
- ❌ Validações complexas gate system
- ❌ Overrides especiais
- ❌ Processadores externos de estratégia
- ❌ Dados mockados (agora reais via TradingView)

---

## 🔄 MOCKADOS (IMPLEMENTAR DEPOIS)

- Gate system validações reais
- Tamanhos de posição dinâmicos  
- Setup rompimento resistência
- Validações de volume
- Health factor checks

---

## 📋 FLUXO DE TESTE

### **Endpoint**
```bash
POST /api/v3/dash-main
```

### **Logs Esperados**
```
🎯 Executando Camada 4: Execução Tática
🚪 Gate: LIBERADO - Aprovado (mockado v1.5.4)
📊 Coletando dados técnicos consolidados...
📊 RSI 4H real: 59.8
🔍 Testando setup: OVERSOLD_EXTREMO
❌ Setup OVERSOLD_EXTREMO não identificado
🔍 Testando setup: PULLBACK_TENDENCIA
✅ Setup PULLBACK_TENDENCIA identificado - Força: alta
🎯 Decisão: COMPRAR - Urgência: alta
```

---

## 🚀 PRÓXIMOS PASSOS

### **v1.5.5 - Gate System Real**
- Implementar validações score risco/mercado
- Integrar health factor AAVE
- Criar validações de margem disponível
- Implementar overrides de proteção

### **v1.5.6 - Tamanhos Dinâmicos**
- Tamanhos baseados em força + ciclo mercado
- Validações de capital disponível
- Regras de scaling por volatilidade

### **v1.5.7 - Setup Rompimento**
- Detectar resistências dinâmicas
- Validar rompimento com volume
- Confirmar sustentação

### **v1.6.0 - Setups Venda**
- Implementar setups de saída
- Sistema de stops dinâmicos
- Take profit automático

---

## ✅ STATUS FINAL v1.5.4

**IMPLEMENTADO:**
- ✅ 4 setups com dados reais TradingView
- ✅ Cálculo de força dinâmico por setup
- ✅ Dados técnicos sempre presentes na saída
- ✅ Logs detalhados para debug
- ✅ Arquitetura simplificada e funcional

**TESTADO:**
- ✅ RSI 4H real funcionando
- ✅ EMAs 17/34/144 4H real funcionando  
- ✅ Gate system mockado funcionando
- ✅ Encadeamento completo até dashboard

---

**Arquitetura v1.5.4 completa e funcional! 🚀**